{{extend 'layout.html'}}
{{block header}}
<script src="{{=URL('static', 'js/vue.js')}}"></script>
<script>
    var getHaircutsUrl = "{{=URL('api', 'get_all_haircuts')}}";
    var getAppointmentsUrl = "{{=URL('api', 'get_appointments')}}";
    var moveBarbersUrl = "{{=URL('api', 'move_barbers')}}";
    var getBarbersUrl = "{{=URL('api', 'get_barbers')}}";
<<<<<<< HEAD
    var makeAppointmentUrl = "{{=URL('api', 'make_appointment_api')}}";
=======
    var makeAppointmentUrl = "{{=URL('api', 'make_appointment_api', user_signature=True)}}";
>>>>>>> 0c73e1c130d1cb9efb0d85b5d7d7af5ea6487dbf
    var getCurrentUserUrl = "{{=URL('api', 'get_current_user')}}";


    var is_logged_in = "{{='false' if auth.user is None else 'true'}}";
    var user_email = "{{='' if auth.user is None else auth.user.email}}";
    var is_barber = "{{='' if auth.user not in db(db.auth_user.Barber == True).select() else 'False'}}";


    var testing = "{{=URL('api', 'testing_api')}}"
</script>
{{end}}


<div id="app">
    <div v-if="home_page">
        <div class="container padded center">
            <h1>Welcome to J&R Barber Shop</h1>
            <img src="{{=URL('static', '138.jpg')}}" style="width: 500px; height: 500px"/>
            <br>
            <button>Haircuts</button>
            <button v-on:click="redirect_barber_page()">Barbers</button>
            <button v-on:click="redirect_appointment_page()">Appointments</button>
            <button v-on:click="get_current_user()">Current User FOR TESTING</button>
        </div>

    </div>
    <div v-if="barber_page">
        <div class="container padded center">
            <h1>Our Barbers</h1>
            <div class="quarter">
<<<<<<< HEAD
                <img src="{{=URL('static', 'image.jpeg')}}" style="width: 100px; height: 100px"/>
                <p>hello</p>
            </div>
            <div class="quarter">
                <img src="{{=URL('static', 'image.jpeg')}}" style="width: 100px; height: 100px"/>
                <p>hi</p>
            </div>
            <button v-on:click="redirect_home_page()">Home</button>
            <button>Haircuts</button>
            <button>Appointments</button>
=======
              {{barbers = db().select(db.auth_user.ALL)}}
              {{for b in barbers:}}
                  {{if b.Barber == True:}}
                      <div>
                      <div><img src="{{=URL('static', 'image.jpeg')}}" style="width: 100px; height: 100px"/></div>
                      {{=b.first_name}}
                      {{=b.last_name}}
                      {{current_bio = db(db.barber_bio.barber_id == b.id).select().first()}}
                      <div>
                      {{if not current_bio:}}
                        {{="No Bio"}}
                      {{else:}}
                        {{=current_bio.body}}
                      {{pass}}
                      </div>
                      </div>
                      <p></p>
                      {{pass}}
                  {{pass}}
              {{pass}}
>>>>>>> 0c73e1c130d1cb9efb0d85b5d7d7af5ea6487dbf
        </div>
    </div>
    <div v-if="haircut_page">
        <img src="{{=URL('static', 'haircut_pictures/haircut1.png')}}"/>
    </div>


    <div v-if="appointment_page">
        <input type="date" v-model="selected_date">

        <select v-model="selected_barber">
            <option disabled value="">Select a barber</option>
        {{barbers = db().select(db.auth_user.ALL)}}
        {{for b in barbers:}}
        {{if b.Barber == True:}}
            <option v-on:click="get_appointments()" value="{{=b.id}}">{{=b.first_name + " " + b.last_name}}</option>
        {{pass}}
        {{pass}}
<<<<<<< HEAD
        </select>

        <select v-model="selected_time">
            <option disabled value="">Select a time</option>
            <option v-for="time in valid_times" value="${time.id}">${time.timeslot}</option>
        </select>

        <p v-for="time in valid_times">${time}</p>

=======
        </select>

        <select v-model="selected_time">
            <option disabled value="">Select a time</option>
            <option v-for="time in valid_times" v-bind:value="time.id">${time.timeslot}</option>
        </select>

        <p v-for="time in valid_times">${time}</p>

>>>>>>> 0c73e1c130d1cb9efb0d85b5d7d7af5ea6487dbf
        <button v-on:click="get_current_user()">Get current user (PLACEHOLDER)</button>

        <button v-on:click="get_appointments()">Call get_appointments()</button>

        <button v-on:click="make_appointment()">Create Appointment</button>
        <button v-on:click="test_print()">test</button>
        <button v-on:click="display_appt_table()">Show Appts</button>

        <!-- <div v-if="show_appt_table == True"> -->

            <div v-for="each in barbers_list" v-if="each.email == selected_user.email">
                <div class="table-title">
                    <h3>Appointments</h3>
                </div>
                <table class="table-fill">
                    <thead>
                    <tr>
                        <th class="text-left">Time</th>
                        <th class="text-left">Customer</th>
                    </tr>
                    </thead>

                    <tbody class="table-hover">
                    <tr>
                        {{appointments = db((db.auth_user.id == db.appointments.user_id) & (auth.user_id == db.appointments.barber_id)).select()}}

                        {{print type(appointments)}}

                        {{for appt in appointments:}}
<<<<<<< HEAD
                            {{print appt}}
                            {{print 'hello'}}
                            {{customer = db(db.auth_user.id == appt.auth_user.id).select().first()}}
                            {{print 'hi'}}
                            {{time = db(db.timeslots.id == appt.appointments.timeslot_id).select().first()}}
                            <td class="text-left">{{=time.timeslot}}</td>
                            <td class="text-left">{{=customer.first_name + " " + customer.last_name}}</td>
=======
                            {{print 'hello'}}
                            {{my_date = datetime.datetime.now().strftime('%Y-%m-%d 00:00:00')}}
                            {{customer = db(db.auth_user.id == appt.auth_user.id).select().first()}}
                            {{print 'hi'}}
                            {{time = db(db.timeslots.id == appt.appointments.timeslot_id).select().first()}}
                            <div>
                            <td class="text-left">{{=time.timeslot}}</td>
                            <td class="text-left">{{=customer.first_name + " " + customer.last_name}}</td>
                            </div>
>>>>>>> 0c73e1c130d1cb9efb0d85b5d7d7af5ea6487dbf
                        {{pass}}
                    </tr>
                    </tbody>
                </table>
            </div>
        <!-- </div> -->

    </div>


    <script src="{{=URL('static', 'js/default_index.js')}}"></script>
</div>

<!--
    Dropdown menus
    <select>
        <option>First option</option>
    </select>


    <select>
        <option v-for="time in vueObject>time.timeslot></option>
    </select>

-->
